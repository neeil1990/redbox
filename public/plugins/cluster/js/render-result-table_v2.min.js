function renderResultTable_v2(t,e){let a=0,l=0,s=4,o={},r=!0,i=!1;Object.keys(t).reduce((e,c)=>e.then(e=>{let d=t[c];return new Promise(function(t){requestAnimationFrame(()=>{let n=0;for(let t in d)n++;if(n>2){let t=(Math.random()+1).toString(36).substring(5),o=[],n=0,p=!1,h="",u="",y="",b="",g="";$.each(d,function(e,l){if("finallyResult"!==e){a++,n++,$("#rendered-clusters").html(a);let s=0;"phrased"in l&&(s=0===l.phrased?0:l.phrased.number);let c=0;"target"in l&&(c=0===l.target?0:l.target.number);let f=0;"based"in l&&(f=0===l.based?0:l.based.number),"groupName"in d.finallyResult?(b='<th style="border-top-width: 2px;">Группа</th>',g='<td class="border-0 group-'+t+'">'+d.finallyResult.groupName+"</td>"):r=!1;let m="";"merge"in l&&$.each(l.merge,function(t,e){m='<span class="__helper-link ui_tooltip_w click_tracking" data-click="Viewing a related phrase">      <i class="fa fa-question"></i>      <span class="ui_tooltip __right" style="min-width: 550px;">          <span class="ui_tooltip_content">'+t+"<br> "+e+"</span>      </span>  </span>"});let k,v,w,_="";"link"in l?(_='<td class="border-0 relevance-'+t+'"> <a href="'+l.link+'" target="_blank">'+l.link+" </a></td>",h='<th style="border-top-width: 2px;">Релевантные url </th>',i=!0,p=!0):"relevance"in l&&0!==l.relevance&&($.each(l.relevance,function(t,e){_+='<option value="'+e+'">'+e+"</option>",o.push(e)}),_='<div class="d-flex"><select style="border-radius: 0 !important;" class="custom-select" id="'+e.replaceAll(" ","-")+'">'+_+'</select><button style="border-radius: 0 !important;" class="btn btn-secondary save-relevance-url" data-order="'+e+'"><i class="fa fa-save" style="color: white"></i></button></div>',_='<td class="border-0 relevance-'+t+'"> '+_+"</td>",h='<th style="border-top-width: 2px;">Релевантные url </th>',i=!0,p=!0),o.length>0&&(u='<button class="btn btn-secondary save-all-urls" data-toggle="modal" data-target="#saveUrlsModal">Сохранить url</button>'),"basedNormal"in l&&(!1===l.basedNormal||!0!==l.basedNormal)?(v="bg-cluster-warning",k=`title='Ваша фраза "${e}" была изменена'`,w=l.based.phrase):(v="",k="",w=e),y+='<tr>   <td class="border-0">'+a+'</td>    <td class="border-0"> '+n+'</td>    <td class="border-0 '+v+'" '+k+'>        <div class="d-flex justify-content-between">           <div class="cluster-id-'+t+'">'+w+'</div>           <div class="ml-1">             <i class="fa fa-copy copy-full-urls click_tracking" data-click="Copy urls" data-action="'+e+'"></i>             <span class="__helper-link ui_tooltip_w click_tracking" data-click="View links phrases">                 <i class="fa fa-paperclip" data-action="'+e+'"></i>                 <span class="ui_tooltip __bottom" style="min-width: 250px;">                     <span class="ui_tooltip_content" data-action="'+e+'"> </span>                 </span>             </span>'+m+"          </div>        </div>   </td> "+g+_+'   <td class="border-0 base-'+t+'" data-target="'+f+'">'+f+'</td>   <td class="border-0 phrase-'+t+'" data-target="'+s+'">'+s+'</td>   <td class="border-0 target-'+t+'" data-target="'+c+'">'+c+"</td></tr>"}});let f=r?'<p class="copy-group col mr-1 click_tracking" data-click="Copy group" data-target="'+t+'" data-toggle="collapse"><i class="fa fa-copy pr-1"></i>группу</p>':"";p&&(s=5),l++,e.push('<tr class="render"><td class="p-0"><table class="table table-hover render-table" id="render-table'+c+'" style="width: 100%"><thead><tr><th colspan="'+s+'" style="border-bottom: 0; border-top: 0;"></th><th class="centered-text border-0" colspan="3">Частотность</th></tr><tr><th style="border-top-width: 2px;min-width: 25px;">#</th><th style="border-top-width: 2px;min-width: 30px;">##</th><th style="border-top-width: 2px;min-width: 250px;">Ключевой запрос</th>'+b+h+'<th style="border-top-width: 2px;min-width: 70px;">Базовая</th><th style="border-top-width: 2px;min-width: 100px;">"Фразовая"</th><th style="border-top-width: 2px;min-width: 100px;">"!Точная"</th></tr></thead><tbody>'+y+'</tbody></table></td><td><div class="row" style="cursor: pointer"><p class="copy-cluster-phrases col mr-1 click_tracking" data-click="Copy phrase" data-target="'+t+'" data-toggle="collapse"><i class="fa fa-copy pr-1"></i>ключевой запрос</p>'+f+'</div><div class="row" style="cursor: pointer"><p class="copy-based col click_tracking" data-click="Copy based" data-target="'+t+'" data-toggle="collapse">     <i class="fa fa-copy pr-1"></i>базовую</p><p class="copy-phrase col click_tracking" data-click="Copy phrased" data-target="'+t+'" data-toggle="collapse">     <i class="fa fa-copy pr-1"></i>фразовую</p><p class="copy-target col click_tracking" data-click="Copy target" data-target="'+t+'" data-toggle="collapse">     <i class="fa fa-copy pr-1"></i>точную</p></div><div class="row" style="cursor: pointer"><div class="col-6"> <a class="btn btn-secondary all-competitors click_tracking" data-click="Show competitors" data-action="'+c+'" data-toggle="collapse" href="#competitors-'+c.replaceAll(" ","-")+'" role="button" aria-expanded="false" aria-controls="competitors-'+c.replaceAll(" ","-")+'"> Конкуренты</a></div><div class="col-6">'+u+'</div></div><div class="collapse" id="competitors-'+c.replaceAll(" ","-")+'"> </div></td></tr>')}else o[c]=d;$("#rendered-clusters").html(a),l=0,t(e)})})}),Promise.resolve([])).then(function(t){$("#clusters-table-tbody").append(t.join(" ")),prepareFunctions(o,a,s,r,e)})}function prepareFunctions(t,e,a,l,s){renderAlonePhrases(t,e,a),coloredPhrases(),copyBased(),copyPhrases(),copyTarget(),copyCluster(),l&&copyGroup(),$(".copy-full-urls").unbind().on("click",function(){let t=$(this).attr("data-action");downloadSites(s,t,"copy")}),$(".fa.fa-paperclip").hover(function(){let t=$(this).attr("data-action");downloadSites(s,t,"download")}),$(".all-competitors").unbind().on("click",function(){downloadAllCompetitors(s,$(this).attr("data-action"))})}function renderAlonePhrases(t,e,a){let l=0,s=[];for(let e in t)l++;if(l>0){let l=!1,o=0,r="",i="",c=(Math.random()+1).toString(36).substring(7),d="",n="",p="",h=!1;$.each(t,function(t,a){$.each(a,function(t,s){if("finallyResult"!==t){e++,o++;let i=0;"phrased"in s&&(i=0===s.phrased?0:s.phrased.number);let u=0;"target"in s&&(u=0===s.target?0:s.target.number);let y=0;"based"in s&&(y=0===s.based?0:s.based.number),"groupName"in a.finallyResult&&(d='<th style="border-top-width: 2px;">Группа</th>',n='<td class="border-0 group-'+c+'">'+a.finallyResult.groupName+"</td>");let b="";"merge"in s&&$.each(s.merge,function(t,e){b='<span class="__helper-link ui_tooltip_w click_tracking" data-click="Viewing a related phrase">      <i class="fa fa-question"></i>      <span class="ui_tooltip __right" style="min-width: 550px;">          <span class="ui_tooltip_content">'+t+"<br> "+e+"</span>      </span>  </span>"});let g,f,m,k="";"link"in s?(k='<td class="border-0 relevance-'+c+'"> <a href="'+s.link+'" target="_blank">'+s.link+" </a></td>",p='<th style="border-top-width: 2px;">Релевантные url </th>',l=!0,h=!0):"relevance"in s&&0!==s.relevance&&($.each(s.relevance,function(t,e){k+='<option value="'+e+'">'+e+"</option>"}),k='<div class="d-flex"><select style="border-radius: 0 !important;" class="custom-select" id="'+t.replaceAll(" ","-")+'">'+k+'</select><button style="border-radius: 0 !important;" class="btn btn-secondary save-relevance-url" data-order="'+t+'"><i class="fa fa-save" style="color: white"></i></button></div>',k='<td class="border-0 relevance-'+c+'"> '+k+"</td>",p='<th style="border-top-width: 2px;">Релевантные url </th>',l=!0,h=!0),"basedNormal"in s&&(!1===s.basedNormal||!0!==s.basedNormal)?(f="bg-cluster-warning",g=`title='Ваша фраза "${t}" была изменена'`,m=s.based.phrase):(f="",g="",m=t),r+='<tr>   <td class="border-0">'+e+'</td>    <td class="border-0"> '+o+'</td>    <td class="border-0 '+f+'" '+g+'>        <div class="d-flex justify-content-between">           <div class="cluster-id-'+c+'">'+m+'</div>           <div class="ml-1">             <i class="fa fa-copy copy-full-urls click_tracking" data-click="Copy urls" data-action="'+t+'"></i>             <span class="__helper-link ui_tooltip_w click_tracking" data-click="View links phrases">                 <i class="fa fa-paperclip" data-action="'+t+'"></i>                 <span class="ui_tooltip __bottom" style="min-width: 250px;">                     <span class="ui_tooltip_content" data-action="'+t+'"> </span>                 </span>             </span>'+b+"          </div>        </div>   </td> "+n+k+'   <td class="border-0 base-'+c+'" data-target="'+y+'">'+y+'</td>   <td class="border-0 phrase-'+c+'" data-target="'+i+'">'+i+'</td>   <td class="border-0 target-'+c+'" data-target="'+u+'">'+u+"</td></tr>"}})});let u="";i+='<tr class="render">   <td class="p-0">       <table class="table table-hover render-table" id="render-tableAlone" style="width: 100%">       <thead>           <tr>               <th colspan="'+a+'" style="border-bottom: 0; border-top: 0;">Не распределённые</th>               <th class="centered-text border-0" colspan="3">Частотность</th>           </tr>           <tr>               <th style="border-top-width: 2px;min-width: 25px;">#</th>               <th style="border-top-width: 2px;min-width: 30px;">##</th>               <th style="border-top-width: 2px;min-width: 250px;">Ключевой запрос</th>'+d+p+'               <th style="border-top-width: 2px;min-width: 70px;">Базовая</th>               <th style="border-top-width: 2px;min-width: 100px;">"Фразовая"</th>               <th style="border-top-width: 2px;min-width: 100px;">"!Точная"</th>           </tr>       </thead>       <tbody>'+r+'</tbody>       </table>   </td>   <td>       <div class="row" style="cursor: pointer">            <p class="copy-cluster-phrases col mr-1 click_tracking" data-click="Copy phrase" data-target="'+c+'" data-toggle="collapse">                <i class="fa fa-copy pr-1"></i>ключевой запрос            </p>'+(u='<p class="copy-group col mr-1 click_tracking" data-click="Copy group" data-target="'+c+'" data-toggle="collapse">   <i class="fa fa-copy pr-1"></i>группу</p>')+'       </div>       <div class="row" style="cursor: pointer">              <p class="copy-based col click_tracking" data-click="Copy based" data-target="'+c+'" data-toggle="collapse">                   <i class="fa fa-copy pr-1"></i>базовую              </p>              <p class="copy-phrase col click_tracking" data-click="Copy phrased" data-target="'+c+'" data-toggle="collapse">                   <i class="fa fa-copy pr-1"></i>фразовую              </p>              <p class="copy-target col click_tracking" data-click="Copy target" data-target="'+c+'" data-toggle="collapse">                   <i class="fa fa-copy pr-1"></i>точную              </p>       </div>   </td></tr>',s.push(i),$("#rendered-clusters").html(e)}Object.keys(s).length>0&&($("#clusters-table-tbody").append(s.join(" ")),$("#rendered-clusters").html(e)),setTimeout(()=>{$("#loader-block").hide(300),$("#result-table").show(),$("#block-for-downloads-files").show()},2e3)}function coloredPhrases(){$(".colored-phrases").unbind("click").on("click",function(){let t=$(this).parent().children("div").eq(0).html().split("<br>");$.each($("#clusters-table > tbody > tr > td > table > tbody > tr").find("td:eq(2)"),function(e,a){let l=$(this).children("div").eq(0).children("div").eq(0).html();-1!==t.indexOf(l)?$(this).css({background:"#f5e2aa"}):$(this).css({background:"white"})})})}function copyCluster(){$(".copy-cluster-phrases").unbind().on("click",function(){$("#hiddenForCopy").css("display","block"),$("#hiddenForCopy").val("");let t=$(this).attr("data-target"),e=$(".cluster-id-"+t);$.each(e,function(t,e){let a=$(this).html().trim();""===$("#hiddenForCopy").val()?$("#hiddenForCopy").val(a):$("#hiddenForCopy").val($("#hiddenForCopy").val()+"\n"+a)}),copyInBuffer(),successCopiedMessage()})}function copyGroup(){$(".copy-group").unbind().on("click",function(){$("#hiddenForCopy").css("display","block"),$("#hiddenForCopy").val("");let t=$(this).attr("data-target"),e=$(".group-"+t);$.each(e,function(t,e){let a=$(this).html().trim();""===$("#hiddenForCopy").val()?$("#hiddenForCopy").val(a):$("#hiddenForCopy").val($("#hiddenForCopy").val()+"\n"+a)}),copyInBuffer()})}function copyBased(){$(".copy-based").unbind().on("click",function(){$("#hiddenForCopy").css("display","block"),$("#hiddenForCopy").val("");let t=$(this).attr("data-target"),e=$(".base-"+t);$.each(e,function(t,e){let a=$(this).html().trim();""===$("#hiddenForCopy").val()?$("#hiddenForCopy").val(a):$("#hiddenForCopy").val($("#hiddenForCopy").val()+"\n"+a)}),copyInBuffer()})}function copyPhrases(){$(".copy-phrase").unbind().on("click",function(){$("#hiddenForCopy").css("display","block"),$("#hiddenForCopy").val("");let t=$(this).attr("data-target"),e=$(".phrase-"+t);$.each(e,function(t,e){let a=$(this).html().trim();""===$("#hiddenForCopy").val()?$("#hiddenForCopy").val(a):$("#hiddenForCopy").val($("#hiddenForCopy").val()+"\n"+a)}),copyInBuffer()})}function copyTarget(){$(".copy-target").unbind().on("click",function(){$("#hiddenForCopy").css("display","block"),$("#hiddenForCopy").val("");let t=$(this).attr("data-target"),e=$(".target-"+t);$.each(e,function(t,e){let a=$(this).html().trim();""===$("#hiddenForCopy").val()?$("#hiddenForCopy").val(a):$("#hiddenForCopy").val($("#hiddenForCopy").val()+"\n"+a)}),copyInBuffer()})}function copyInBuffer(){successCopiedMessage(),$("#hiddenForCopy").css("display","block"),document.getElementById("hiddenForCopy").select(),document.execCommand("copy"),$("#hiddenForCopy").css("display","none")}
