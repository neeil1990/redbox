function renderResultTable_v2(t){let e=0,a=!0,s=!1,l={},o=4;$.each(t,function(t,r){let d=0;for(let t in r)d++;if(d>2){let l,d=0,i="",c="",n=(Math.random()+1).toString(36).substring(7),p=[],h="",b="",y="",u="",f=!1;$.each(r,function(t,l){if("finallyResult"!==t){e++,d++;let o=0;"phrased"in l&&(o=0===l.phrased?0:l.phrased.number);let c=0;"target"in l&&(c=0===l.target?0:l.target.number);let g=0;"based"in l&&(g=0===l.based?0:l.based.number),"groupName"in r.finallyResult?(h='<th style="border-top-width: 2px;">Группа</th>',b='<td class="border-0 group-'+n+'">'+r.finallyResult.groupName+"</td>"):a=!1;let v="";"merge"in l&&$.each(l.merge,function(t,e){v='<span class="__helper-link ui_tooltip_w">      <i class="fa fa-question"></i>      <span class="ui_tooltip __right" style="min-width: 550px;">          <span class="ui_tooltip_content">'+t+"<br> "+e+"</span>      </span>  </span>"});let m,w,x,C="";"link"in l?(C='<td class="border-0 relevance-'+n+'"> <a href="'+l.link+'" target="_blank">'+l.link+" </a></td>",y='<th style="border-top-width: 2px;">Релевантные url </th>',s=!0,f=!0):"relevance"in l&&0!==l.relevance&&($.each(l.relevance,function(t,e){C+='<option value="'+e+'">'+e+"</option>",p.push(e)}),C='<div class="d-flex"><select style="border-radius: 0 !important;" class="custom-select" id="'+t.replaceAll(" ","-")+'">'+C+'</select><button style="border-radius: 0 !important;" class="btn btn-secondary save-relevance-url" data-order="'+t+'"><i class="fa fa-save" style="color: white"></i></button></div>',C='<td class="border-0 relevance-'+n+'"> '+C+"</td>",y='<th style="border-top-width: 2px;">Релевантные url </th>',s=!0,f=!0),p.length>0&&(u='<button class="btn btn-secondary save-all-urls" data-toggle="modal" data-target="#saveUrlsModal">Сохранить url</button>'),"basedNormal"in l&&(!1===l.basedNormal||!0!==l.basedNormal)?(w="bg-cluster-warning",m=`title='Ваша фраза "${t}" была изменена'`,x=l.based.phrase):(w="",m="",x=t),i+='<tr>   <td class="border-0">'+e+'</td>    <td class="border-0"> '+d+'</td>    <td class="border-0 '+w+'" '+m+'>        <div class="d-flex justify-content-between">           <div class="cluster-id-'+n+'">'+x+'</div>           <div class="ml-1">             <i class="fa fa-copy copy-full-urls" data-action="'+t+'"></i>             <span class="__helper-link ui_tooltip_w">                 <i class="fa fa-paperclip" data-action="'+t+'"></i>                 <span class="ui_tooltip __bottom" style="min-width: 250px;">                     <span class="ui_tooltip_content" data-action="'+t+'"> </span>                 </span>             </span>'+v+"          </div>        </div>   </td> "+b+C+'   <td class="border-0 base-'+n+'" data-target="'+g+'">'+g+'</td>   <td class="border-0 phrase-'+n+'" data-target="'+o+'">'+o+'</td>   <td class="border-0 target-'+n+'" data-target="'+c+'">'+c+"</td></tr>"}}),f&&(o=5),c+='<tr class="render">   <td class="p-0">       <table class="table table-hover render-table" id="render-table'+t+'" style="width: 100%">       <thead>           <tr>               <th colspan="'+o+'" style="border-bottom: 0; border-top: 0;"></th>               <th class="centered-text border-0" colspan="3">Частотность</th>           </tr>           <tr>               <th style="border-top-width: 2px;min-width: 25px;">#</th>               <th style="border-top-width: 2px;min-width: 30px;">##</th>               <th style="border-top-width: 2px;min-width: 250px;">Ключевой запрос</th>'+h+y+'               <th style="border-top-width: 2px;min-width: 70px;">Базовая</th>               <th style="border-top-width: 2px;min-width: 100px;">"Фразовая"</th>               <th style="border-top-width: 2px;min-width: 100px;">"!Точная"</th>           </tr>       </thead>       <tbody>'+i+'</tbody>       </table>   </td>   <td>       <div class="row" style="cursor: pointer">            <p class="copy-cluster-phrases col mr-1" data-target="'+n+'" data-toggle="collapse">                <i class="fa fa-copy pr-1"></i>ключевой запрос            </p>'+(l=a?'<p class="copy-group col mr-1" data-target="'+n+'" data-toggle="collapse">   <i class="fa fa-copy pr-1"></i>группу</p>':"")+'       </div>       <div class="row" style="cursor: pointer">              <p class="copy-based col" data-target="'+n+'" data-toggle="collapse">                   <i class="fa fa-copy pr-1"></i>базовую              </p>              <p class="copy-phrase col" data-target="'+n+'" data-toggle="collapse">                   <i class="fa fa-copy pr-1"></i>фразовую              </p>              <p class="copy-target col" data-target="'+n+'" data-toggle="collapse">                   <i class="fa fa-copy pr-1"></i>точную              </p>       </div>        <div class="row" style="cursor: pointer">            <div class="col-6">                 <a class="btn btn-secondary all-competitors" data-action="'+t+'" data-toggle="collapse"                   href="#competitors-'+t.replaceAll(" ","-")+'" role="button" aria-expanded="false"                   aria-controls="competitors-'+t.replaceAll(" ","-")+'">                   Конкуренты               </a>            </div>           <div class="col-6">'+u+'</div>       </div>       <div class="collapse" id="competitors-'+t.replaceAll(" ","-")+'"> </div>   </td></tr>',$("#clusters-table-tbody").append(c)}else l[t]=r}),renderAlonePhrases(l,e,o),coloredPhrases(),copyBased(),copyPhrases(),copyTarget(),copyCluster(),a&&copyGroup(),$(document).ready(function(){$.each($(".render-table"),function(t,e){$("#"+$(this).attr("id")).dataTable({order:[[0,"asc"]],bPaginate:!1,orderCellsTop:!0,sDom:'<"top"i>rt<"bottom"lp><"clear">'})})})}function renderAlonePhrases(t,e,a){let s=0;for(let e in t)s++;if(s>0){let s=!1,l=0,o="",r="",d=(Math.random()+1).toString(36).substring(7),i="",c="",n="",p=!1;$.each(t,function(t,a){$.each(a,function(t,r){if("finallyResult"!==t){l++;let h=0;"phrased"in r&&(h=0===r.phrased?0:r.phrased.number);let b=0;"target"in r&&(b=0===r.target?0:r.target.number);let y=0;"based"in r&&(y=0===r.based?0:r.based.number),"groupName"in a.finallyResult&&(i='<th style="border-top-width: 2px;">Группа</th>',c='<td class="border-0 group-'+d+'">'+a.finallyResult.groupName+"</td>");let u="";"merge"in r&&$.each(r.merge,function(t,e){u='<span class="__helper-link ui_tooltip_w">      <i class="fa fa-question"></i>      <span class="ui_tooltip __right" style="min-width: 550px;">          <span class="ui_tooltip_content">'+t+"<br> "+e+"</span>      </span>  </span>"});let f,g,v,m="";"link"in r?(m='<td class="border-0 relevance-'+d+'"> <a href="'+r.link+'" target="_blank">'+r.link+" </a></td>",n='<th style="border-top-width: 2px;">Релевантные url </th>',s=!0,p=!0):"relevance"in r&&0!==r.relevance&&($.each(r.relevance,function(t,e){m+='<option value="'+e+'">'+e+"</option>"}),m='<div class="d-flex"><select style="border-radius: 0 !important;" class="custom-select" id="'+t.replaceAll(" ","-")+'">'+m+'</select><button style="border-radius: 0 !important;" class="btn btn-secondary save-relevance-url" data-order="'+t+'"><i class="fa fa-save" style="color: white"></i></button></div>',m='<td class="border-0 relevance-'+d+'"> '+m+"</td>",n='<th style="border-top-width: 2px;">Релевантные url </th>',s=!0,p=!0),"basedNormal"in r&&(!1===r.basedNormal||!0!==r.basedNormal)?(g="bg-cluster-warning",f=`title='Ваша фраза "${t}" была изменена'`,v=r.based.phrase):(g="",f="",v=t),o+='<tr>   <td class="border-0">'+e+'</td>    <td class="border-0"> '+l+'</td>    <td class="border-0 '+g+'" '+f+'>        <div class="d-flex justify-content-between">           <div class="cluster-id-'+d+'">'+v+'</div>           <div class="ml-1">             <i class="fa fa-copy copy-full-urls" data-action="'+t+'"></i>             <span class="__helper-link ui_tooltip_w">                 <i class="fa fa-paperclip" data-action="'+t+'"></i>                 <span class="ui_tooltip __bottom" style="min-width: 250px;">                     <span class="ui_tooltip_content" data-action="'+t+'"> </span>                 </span>             </span>'+u+"          </div>        </div>   </td> "+c+m+'   <td class="border-0 base-'+d+'" data-target="'+y+'">'+y+'</td>   <td class="border-0 phrase-'+d+'" data-target="'+h+'">'+h+'</td>   <td class="border-0 target-'+d+'" data-target="'+b+'">'+b+"</td></tr>",e++}})});let h="";r+='<tr class="render">   <td class="p-0">       <table class="table table-hover render-table" id="render-tableAlone" style="width: 100%">       <thead>           <tr>               <th colspan="'+a+'" style="border-bottom: 0; border-top: 0;">Не распределённые</th>               <th class="centered-text border-0" colspan="3">Частотность</th>           </tr>           <tr>               <th style="border-top-width: 2px;min-width: 25px;">#</th>               <th style="border-top-width: 2px;min-width: 30px;">##</th>               <th style="border-top-width: 2px;min-width: 250px;">Ключевой запрос</th>'+i+n+'               <th style="border-top-width: 2px;min-width: 70px;">Базовая</th>               <th style="border-top-width: 2px;min-width: 100px;">"Фразовая"</th>               <th style="border-top-width: 2px;min-width: 100px;">"!Точная"</th>           </tr>       </thead>       <tbody>'+o+'</tbody>       </table>   </td>   <td>       <div class="row" style="cursor: pointer">            <p class="copy-cluster-phrases col mr-1" data-target="'+d+'" data-toggle="collapse">                <i class="fa fa-copy pr-1"></i>ключевой запрос            </p>'+(h='<p class="copy-group col mr-1" data-target="'+d+'" data-toggle="collapse">   <i class="fa fa-copy pr-1"></i>группу</p>')+'       </div>       <div class="row" style="cursor: pointer">              <p class="copy-based col" data-target="'+d+'" data-toggle="collapse">                   <i class="fa fa-copy pr-1"></i>базовую              </p>              <p class="copy-phrase col" data-target="'+d+'" data-toggle="collapse">                   <i class="fa fa-copy pr-1"></i>фразовую              </p>              <p class="copy-target col" data-target="'+d+'" data-toggle="collapse">                   <i class="fa fa-copy pr-1"></i>точную              </p>       </div>   </td></tr>',$("#clusters-table-tbody").append(r)}}function coloredPhrases(){$(".colored-phrases").unbind("click").on("click",function(){let t=$(this).parent().children("div").eq(0).html().split("<br>");$.each($("#clusters-table > tbody > tr > td > table > tbody > tr").find("td:eq(2)"),function(e,a){let s=$(this).children("div").eq(0).children("div").eq(0).html();-1!==t.indexOf(s)?$(this).css({background:"#f5e2aa"}):$(this).css({background:"white"})})})}function copyCluster(){$(".copy-cluster-phrases").unbind().on("click",function(){$("#hiddenForCopy").css("display","block"),$("#hiddenForCopy").val("");let t=$(this).attr("data-target"),e=$(".cluster-id-"+t);$.each(e,function(t,e){let a=$(this).html().trim();""===$("#hiddenForCopy").val()?$("#hiddenForCopy").val(a):$("#hiddenForCopy").val($("#hiddenForCopy").val()+"\n"+a)}),copyInBuffer(),successCopiedMessage()})}function copyGroup(){$(".copy-group").unbind().on("click",function(){$("#hiddenForCopy").css("display","block"),$("#hiddenForCopy").val("");let t=$(this).attr("data-target"),e=$(".group-"+t);$.each(e,function(t,e){let a=$(this).html().trim();""===$("#hiddenForCopy").val()?$("#hiddenForCopy").val(a):$("#hiddenForCopy").val($("#hiddenForCopy").val()+"\n"+a)}),copyInBuffer()})}function copyBased(){$(".copy-based").unbind().on("click",function(){$("#hiddenForCopy").css("display","block"),$("#hiddenForCopy").val("");let t=$(this).attr("data-target"),e=$(".base-"+t);$.each(e,function(t,e){let a=$(this).html().trim();""===$("#hiddenForCopy").val()?$("#hiddenForCopy").val(a):$("#hiddenForCopy").val($("#hiddenForCopy").val()+"\n"+a)}),copyInBuffer()})}function copyPhrases(){$(".copy-phrase").unbind().on("click",function(){$("#hiddenForCopy").css("display","block"),$("#hiddenForCopy").val("");let t=$(this).attr("data-target"),e=$(".phrase-"+t);$.each(e,function(t,e){let a=$(this).html().trim();""===$("#hiddenForCopy").val()?$("#hiddenForCopy").val(a):$("#hiddenForCopy").val($("#hiddenForCopy").val()+"\n"+a)}),copyInBuffer()})}function copyTarget(){$(".copy-target").unbind().on("click",function(){$("#hiddenForCopy").css("display","block"),$("#hiddenForCopy").val("");let t=$(this).attr("data-target"),e=$(".target-"+t);$.each(e,function(t,e){let a=$(this).html().trim();""===$("#hiddenForCopy").val()?$("#hiddenForCopy").val(a):$("#hiddenForCopy").val($("#hiddenForCopy").val()+"\n"+a)}),copyInBuffer()})}function copyInBuffer(){successCopiedMessage(),$("#hiddenForCopy").css("display","block"),document.getElementById("hiddenForCopy").select(),document.execCommand("copy"),$("#hiddenForCopy").css("display","none")}
